{% extends "sidebarbase.html" %}
{% load compress static i18n thumbnail parliament %}

{% block title %}{{doc.name}}: {{doc.subject}}{% endblock %}

{% block main_class %}document-details{% endblock %}

{% block sidebar %}
<div class="issue-card">
    <div class="page-heading">
        <h4>{{doc.subject}}</h4>
    </div>
    <div class="details">
        <span class="type">{{doc.get_type_display}}</span>
        <small class="number">{{doc.name}}</small>
        <div class="labels">
            {% for kw in doc.keywords.all %}
            <a class="issue-tag-small" 
              href="{% url "parliament.views.show_topic" topic=kw.pk slug=kw.get_slug %}"
              >{{kw.name}}</a>
            {% endfor %}
        </div>
        {% if doc.author %}
        <div class="document-author">
            <span class="author-label">{% trans "Author" %}</span>
            <a href="{{doc.author.get_absolute_url}}">{{doc.author.get_print_name}}</a>
            {% thumbnail doc.author.photo "64x96" as tn %}
            <a href="{{doc.author.get_absolute_url}}"><img src="{{tn.url}}"></a>
            {% endthumbnail %}
        </div>
        {% endif %}
    </div>
    <div class="share-button"></div>
</div>
<div class="box hide similar-documents related-sidebar">
    <h4>{% trans "Similar documents" %}</h4>
    <ol></ol>
</div>
{% endblock %}

{% block main_content %}
<div class="row">
    <div>
        <div class="proposal-content content">
            {% if doc.summary %}
            <h4>{% trans "Proposal content" %}</h4>
            <div class="proposal-summary">{{doc.summary|linebreaks}}</div>
            {% endif %}

            <a href="{{ doc.get_origin_url }}">{% trans "Link to original document" %}</a>

            {% if doc.question %}
            {% with member=doc.author %}
            <div class="proposal-statement media side-opposition">
                <a class="statement-portrait" href="{{member.get_absolute_url}}">
                    {% thumbnail member.photo "64x64" as tn %}
                    <img class="media-object" src="{{tn.url}}">
                    {% endthumbnail %}
                </a>
                <div class="media-body proposal-statement-content">
                    <h5 class="media-heading">{{member}} /{{member.party.abbreviation}}</h5>
                    <div class="proposal-statement-text">
                        {{doc.question|linebreaks}}
                    </div>
                </div>
            </div>
            {% endwith %}
            {% endif %}

            {% if doc.answer %}
            <div class="proposal-statement media side-government">
                <div class="media-body proposal-statement-content">
                    <h5 class="media-heading">{{doc.answerer_title}} {{doc.answerer_name}}</h5>
                    <div class="proposal-statement-text">
                        {{doc.answer|linebreaks}}
                    </div>
                </div>
            </div>
            {% endif %}
            <h2>Käsittelyt</h2>
            <ul class="proposal-progresses">
                  {% for stage in doc.processing_stages %}
                  <li class="{% if stage.date %}passed{% else %}unpassed{% endif %}">
                      <h4 class="progress-phase">{{stage.name|safe}} <i class="typcn typcn-arrow-down"></i></h4>
                      {% if stage.item %}{% with item=stage.item %}
                      <div class="progress-session">
                        <h5><a href="{{ item.get_absolute_url }}"> <i class="typcn typcn-group"></i>Täysistunto {{ item.plsess.date }}</a></h5>
                        <span class="nr_votes"><i class="typcn typcn-tabs-outline" title="{% trans "Plenary votes" %}"></i>{{ item.nr_votes }}</span>
                        <span class="nr_statements"><i class="typcn typcn-message-typing" title="{% trans "Statements" %}"></i>{{ item.nr_statements }}</span>
                      </div>
                      {% endwith %}{% endif %}
                  </li>
                  {% endfor %}
            </ul>
          
            {% if session_items %}
            <a id="statements"></a>
            <h2>{% trans "Statements" %}</h2>
            <div class="proposal-statements">
            {% for item in session_items %}
                <div data-item="{{ item.id }}" class="plenary-discussion">
                    <h4>{% trans "Plenary session" %} {{ item.plsess.date }}</h4>
                    {% for statement in item.statement_set.all %}
                    {% with member=statement.member governing_party=statement.member.party|governing:item.plsess.date %}
                    <div class="proposal-statement media {% if statement.type == 'speaker' %}side-neutral{% elif governing_party %}side-government{% else %}side-opposition{% endif %}" id="{{statement.get_anchor_string}}">
                        <a class="statement-portrait" href="{{member.get_absolute_url}}">
                            {% thumbnail member.photo "64x64" as tn %}
                            <img class="media-object" src="{{tn.url}}">
                            {% endthumbnail %}
                        </a>
                        <div class="media-body proposal-statement-content">
                            {% if member %}
                            <h5 class="media-heading">{{member}} /{{member.party.abbreviation}}
                            {% else %}
                            <h5 class="media-heading">{{statement.speaker_name}} / {{statement.speaker_role}}
                            {% endif %}
                            {% if statement.type == 'speaker' %} ({% trans "speaker" %}) {% endif %}
                            </h5>
                            <div class="proposal-statement-text">
                                {{statement.get_html_text|linebreaks}}
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                    {% endfor %}
                </div>
            {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script type="text/template" id="similar-document-item-template">
<li>
    <a href='<%= url %>'><%= name %>: <%= title %></a>
</li>
</script>

<script type="text/javascript">
document_json = {{document_json|safe}};
</script>

{% compress js %}
<script type="text/coffeescript" src="{% static 'js/document-details.coffee' %}"></script>
{% endcompress %}

{% endblock %}
