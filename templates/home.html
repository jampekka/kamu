{% extends "base.html" %}
{% load i18n compress static thumbnail %}
{% block title %}{% trans "Front page" %}{% endblock %}

{% block head %}
{% compress js inline %}

<script type="text/coffeescript">
$ ->
    return
    activity_feeds = [{
        url: "{% url 'parliament.views.get_parliament_activity' %}"
        more_link: "#parliament-showmore a"
        target_el: "#parliament-activity .post-list"
        offset: {{ parl_act_offset }}
    }, {
        url: "{% url 'parliament.views.get_mp_some_activity' %}"
        more_link: "#livefeed-showmore a"
        target_el: "#livefeed .post-list"
        offset: {{ some_offset }}
    }]

    set_timestamps = ->
        $(".time[title]").each ->
            time = $(this).attr 'title'
            mom = moment time
            $(@).text mom.fromNow()

    set_timestamps()
    for act in activity_feeds
        $(act.more_link).click act, (ev) ->
            act = ev.data
            url = act.url + "?offset=" + act.offset
            $.ajax url,
            	type: 'GET',
            	success: (data) ->
                    html = $("<div>")
                    html.append $(data.html)
                    html.hide()
                    $(act.target_el).append html
                    act.offset = data.offset
                    set_timestamps()
                    html.slideDown()
            return false
    setInterval set_timestamps, 60*1000

    most_active_el = $(".most-active-members")
    most_active_width = 0

    show_active_mps = ->
        width = most_active_el.width()
        if width == most_active_width
            return
        most_active_width = width
        li_list = most_active_el.find('li')
        tn_width = li_list.outerWidth()
        cols = Math.floor(width / tn_width)
        rows = Math.floor(li_list.length / cols)
        if rows == 0
            rows = 1
        if rows > 2
            rows = 2
        count = rows * cols
        for li in li_list[0..count]
            $(li).show()
        for li in li_list[count..]
             $(li).hide()

    $(window).resize show_active_mps
    show_active_mps()
</script>
{% endcompress %}
{% endblock %}

{% block main_class %}home-page{% endblock %}

{% block content %}
<div class="top-feature-box">
    <header>
        <h1>Kansan muisti</h1>
        <p class="lead">Kansan muisti -verkkopalvelussa voit seurata kansanedustajien puheenvuoroja ja äänestyksiä<br> — siis vaalilupausten toteutumista käytännössä.</p>
    </header>
</div>
<div class="row">

<div class="main-col col-md-10 col-md-push-5">
<!--- MP Highlights Layout --->
<div class=""> 
  <div class="box">
    <section class="most-active-members">
      <h3 class="section-header">Aktiivisimmat kansanedustajat</h3>
        <ul>
          {% for mp in most_active_mps %}
          {% endfor %}
        </ul>
    </section>
  </div>
</div>
  
<!--- Issues Highlights Layout --->
<div class="">
  <div class="box">
    <img src="/static/images/etu-asiat-300x200.png" class="highlight-image">
    <h3 class="section-header">Ajankohtaisia aiheita</h3>
    <div>
      <a href="/topic/105-hatakeskukset/">
        <h4 class="issue-highlight">Hätäkeskukset</h4>
      </a>
      <div class="highlight-statement media side-opposition">
        <a id="statement-126/2012/1/1"></a>
        <a class="statement-portrait" href="/member/lohi-markus/">
          <img class="media-object" src="/media/cache/66/8f/668fbdc26dbb33ade5a520e90951534b.jpg">
        </a>
        <div class="media-body highlight-statement-content">
          <div class="summary">
            <h5 class="media-heading">Lohi Markus /kesk</h5>
            <div class="highlight-statement-text">
              <a href="/document/he-64-2012/#statement-126/2012/1/6">
                <p>Viime viikolla poliisin eläkeikää koskevan lain ensimmäisessä käsittelyssä totesimme työurien pidentämisen olevan välttämätöntä. Siihen on olemassa kansantaloudellisia ja työvoiman riittävyyteen liittyviä syitä. Myös eläkejärjestelmämme on koetteilla työ- ja elinkeinoelämän rakennemuutoksissa. [...]</p>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="highlight-source-link">
        <div class="highlight-source-session">
          <a href="/document/he-64-2012/#statement-126/2012/1/0">Täysistunto 11. joulukuuta 2012</a>
        </div>
        <a href="/document/he-64-2012/">Hallituksen esitys eduskunnalle laeiksi poliisin hallinnosta annetun lain 15 §:n muuttamisesta, hätäkeskustoiminnasta annetun lain 30 §:n muuttamisesta ja valtion virkamieslain 35 §:n 2 momentin kumoamisesta</a>
      </div>
      <a href="/topic/724-rekisteroity-parisuhde/">
        <h4 class="issue-highlight">Rekisteröity parisuhde</h4>
      </a>
      <div class="highlight-statement media side-government">
        <a id="statement-27/2012/10/1"></a>
        <a class="statement-portrait" href="/member/stubb-alexander/">
          <img class="media-object" src="/media/cache/0d/94/0d9458951b04e64511a37fe021b5fcfd.jpg">
        </a>
        <div class="media-body highlight-statement-content">
          <div class="summary">
            <h5 class="media-heading">Stubb Alexander /kok</h5>
            <div class="highlight-statement-text">
              <a href="/document/la-2-2012/#statement-number">
                <p>Täytyy heti aluksi myöntää, että jännittää hiukkasen, koska itselleni hetki on siinä mielessä historiallinen, että puhun ensimmäistä kertaa tässä salissa kansanedustajan ominaisuudessa. Toki tässä salissa sai valmistella tätä hetkeä neljä vuotta, niin että siinä mielessä ainakin valmiudet pitäisi olla. [...]</p>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="highlight-source-link">
        <div class="highlight-source-session">
          <a href="/document/he-64-2012/#statement-126/2012/1/0">Täysistunto 11. joulukuuta 2012</a>
        </div>
        <a href="/document/la-2-2012/">Laki avioliittolain muuttamisesta, rekisteröidystä parisuhteesta annetun lain 1 luvun kumoamisesta sekä transseksuaalin sukupuolen vahvistamisesta annetun lain 2 §:n 2 ja 3 momentin kumoamisesta</a>
      </div>
      <a href="/topic/308-tupakkatuotteet/">
        <h4 class="issue-highlight">Tupakkatuotteet</h4>
      </a>
      <div class="highlight-statement media side-opposition">
        <a id="statement-12/2014/4/4"></a>
        <a class="statement-portrait" href="/member/kokko-osmo/">
          <img class="media-object" src="/media/cache/c5/69/c569519cdc5580632ac430f672e4b918.jpg">
        </a>
        <div class="media-body highlight-statement-content">
          <div class="summary">
            <h5 class="media-heading">Kokko Osmo /ps</h5>
            <div class="highlight-statement-text">
              <a href="/document/he-94-2011/">
                <p>Lakialoite, jonka edustaja Jalonen on tehnyt, on mielestäni oikeansuuntainen, koska niin kuin useissa puheenvuoroissa täällä on todettu, tupakka on erittäin haitallinen ja tällä tavalla, tällä uudella lailla, saataisiin hallintaan tämä, että ennen kaikkea nuorten, joissa on tulevaisuus, tupakointia oltaisiin tällä lailla rajoittamassa. [...]</p>
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="highlight-source-link">
        <div class="highlight-source-session">
          <a href="/document/he-64-2012/#statement-126/2012/1/0">Täysistunto 11. joulukuuta 2012</a>
        </div>
        <a href="/document/he-94-2011/">Hallituksen esitys eduskunnalle laiksi tupakkaverosta annetun lain 1 §:n ja liitteen muuttamisesta</a>
      </div>
      <div class="section-link">
        <a href="/topic/">Selaa aiheita >></a>
      </div>
    </div>
  </div>
</div>

  </div> <!-- end main-col -->

  <div class="col-side col-md-5 col-md-pull-10">
<!--- Party Highlights Layout --->
<div class=""> 
  <div class="box">
    <h3 class="section-header">Puolueiden aktiivisuus</h3>
    <ul class="highlight-parties">
      <!--
      <li title="m11">
        <div class="party-highlight">
          <div class="party-thumbnail">
            <a href="/party/m11/">
              <img src="/api/v1/party/m11/logo/?dim=48x48">
            </a>
          </div>
          <div class="party-activity">
            <div class="thumbnail-activity">
              <div class="thumbnail-activity-bar" style="width: 45%"></div>
            </div>
          </div>
          <div class="party-issues">
            <ul class="party-activity--issues">
              <li><a href="/topic/308-tupakkatuotteet/">Tupakkatuotteet</a></li>
              <li><a href="/topic/308-tupakkatuotteet/">Hätäkeskukset</a></li>
              <li><a href="/topic/308-tupakkatuotteet/">Rekisteröity parisuhde</a></li>
            </ul>
          </div>
        </div>
      </li>
      -->
    </ul>
  </div>
</div>
<!--- LATEST NEWS -->
<div>
  <section class="parliament-newsfeed newsfeed box">
    <h3 class="section-header">Viimeisimmät tapahtumat</h3>
    {{parl_act_html|safe}}
    <div id="parliament-showmore" class="showmore-link"><a href="#">{% trans "Show more items" %} &or;</a></div>
  </section>
</div>
</div> <!-- end side-col -->
</div> <!-- end row -->

<script type="text/template" id="most-active-mps-item">
<li>
  <a href="<%= view_url %>"><img class="mp-thumbnail" src="<%= thumbnail_url %>"></a>
  <div class="thumbnail-activity">
    <div class="thumbnail-activity-bar" style="width: <%= activity_percentage %>%"></div>
  </div>
</li>
</script>

<script type="text/template" id="most-active-parties-item">
<li title="<%- name %>">
  <div class="party-highlight">
    <div class="party-thumbnail">
    <a href="<%= view_url %>">
      <img title="<%- name %>" src="<%= thumbnail_url %>">
    </a>
    </div>
    <div class="party-activity">
      <div class="thumbnail-activity">
        <div class="thumbnail-activity-bar" style="width: <%- activity_percentage %>%"></div>
      </div>
    </div>
    <div class="party-issues">
      <ul class="party-activity--issues">
        <% _.each(recent_keywords, function (kw) { %>
        <li><a href="<%= kw.view_url %>"><%- kw.name %></a></li>
        <% }); %>
      </ul>
    </div>
  </div>
</li>
</script>

{% compress js %}
<script type="text/coffeescript" src="{% static 'js/home.coffee' %}"></script>
{% endcompress %}

{% endblock %}
